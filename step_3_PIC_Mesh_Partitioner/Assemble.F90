
! +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
!                                                                                                                                                  ++
! Last Update:  18 JUNE 2011                                                                                                                       ++
!                                                                                                                                                  ++
! Description: THIS Module ASSEMBLES THE ELEMENT MATRICES IN THE TOTAL MATRICES.                                                                   ++
!                                                                                                                                                  ++
!              Subroutines                                     Description                                                                         ++
!              ==============                                  ==============                                                                      ++
!              AssembleStiffnessSkyLline                       ASSEMBLES STIFFNESS MATRIX USING SKYLINE METHOD                                     ++
!              ASSEMBLE_STIFFNESS_FORCE                        ASSEMBLES STIFFNESS AND FORCE MATRICES USING SKYLINE METHOD                         ++
!              ASSEMBLE_MASS_DAMPING_STIFFNESS                 ASSEMBLES STIFFNESS, MASS AND DAMPING MATRICES IN TOTAL SKYLINE MATRICES            ++
!              AssembleMassDampingStiffForceFull               ASSEMBLES FULL MATRICES                                                             ++
!              ASSEMBLE_Interface2                             ASSEMBLES INTERACTION MATRICES                                                      ++
!              ASSEMBLE_PML_Interface                          ASSEMBLES THE STIFFNESS AND MASS ENTRIES AT THE Interface NODES FOR EMERGY          ++
!                                                                                                                                                  ++
! +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Module AssembleSub ;

Use Parameters ;

Implicit None ;

  Interface Assemble ;
    Module Procedure AssembleStiffnessForceFull ;
  End Interface ;


Contains ;

! ***************************************************************************************************************************************************
!                                                                                                                                                  **
! Start:        -- --- 2003                                                                                                                        **
! Last Update:  10 July 2012                                                                                                                       **
! Description: THIS Subroutine ASSEBLES THE ELEMENTAL STIFFNES MATRIX IN THE TOTAL STIFFNESS MATRIX AND THE FORCE VECTOR, SIMULTANEOUSLY.          **
!      <<<<<<<<<<< THIS IS NOT GOOD FOR ZANGAR METHOD, NAT == 7  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>                                                   **
!                                                                                                                                                  **
! ***************************************************************************************************************************************************

Subroutine AssembleStiffnessForceFull (                                                                                         &
NDOF, NDim, NNode,                                                                                                              & ! Integer (1) Variables
NEqEl,                                                                                                                          & ! Integer (2) Variables
!                                                                                                                               & ! Integer (4) Variables
IEl,                                                                                                                            & ! Integer (8) Variables
!                                                                                                                               & ! Real Variables
LoadC, ND,                                                                                                                      & ! Integer Arrays
Ke, Fe,     FK,     P                                                                                                           & ! Real Arrays
!                                                                                                                               & ! Characters
!                                                                                                                               & ! Type
) ;

Implicit None ;

! =========================== Global Variables ======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In)    :: NDOF, NDim, NNode ;
Integer (Kind=Smll), Intent(In)    :: NEqEl ;
Integer (Kind=Lng ), Intent(In)    :: IEL ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In), Dimension (:  )  :: LoadC ;
Integer (Kind=Lng ), Intent(In), Dimension (:  )  :: ND ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
Real (Kind=DBL), Intent(IN   ), Dimension (:,:)  :: Ke, Fe ;
Real (Kind=DBL), Intent(InOut), Dimension (:,:)  :: FK ;
Real (Kind=DBL), Intent(InOut), Dimension (:,:)  :: P ;

! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------

! =========================== LOCAL Variables =======================================================================================================
! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Smll)  :: I, J ;                   ! Loop Indices
Integer (Kind=Lng )  :: L, M ;                   ! Loop Indices
Integer (Kind=Shrt)  :: LCASE ;                  ! Loop Index on Load cases

               
! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------

! =========================== Subroutine CODE =======================================================================================================

  DO I = 1, NEqEl ;
    DO J = 1, NEqEl ;
      L = ND ( I ) ;
      M = ND ( J ) ;
        IF ( L == 0 .OR. M == 0 ) CYCLE ;
        FK ( L, M ) = FK ( L, M ) + Ke ( I, J ) ;
    End Do ;
  End Do ;

LCASE = MaxVal ( LoadC ) ;

  DO I = 1, NEqEl ;
    IF ( ND ( I ) == 0 ) CYCLE ;
    L = ND ( I ) ;
      DO J = 1, LCASE ;
        P ( L, J ) = P ( L, J ) + Fe ( I, J ) ;
      End Do ;
  End Do ;

!#Write(*     ,*) 'End Subroutine < AssembleStiffnessForceFull >' ;
!#Write(UnInf,*) 'End Subroutine < AssembleStiffnessForceFull >' ;
Return ;
End Subroutine AssembleStiffnessForceFull ;


! ***************************************************************************************************************************************************
!                                                                                                                                                  **
! Last Update:  10 JUly 2012                                                                                                                       **
! Description: THIS Subroutine ASSEMBLES ALL FULL MASS, DAMPING AND THE STIFFNESS MATRICES.                                                        **
!                                                                                                                                                  **
!                                                                                                                                                  **
! ***************************************************************************************************************************************************

Subroutine AssembleMassDampingStiffForceFull  (    &
NEqEl, NEqElS, NDOF, NDim, NNode, IEL,                      & ! Integer Variables
!                                                           & ! Real Variables
LoadC, ND,                                                  & ! Integer Arrays
ME, CE, Ke, Fe,    FM, FC, FK, P                            & ! Real Arrays
) ;

Implicit None ;

! =========================== Global Variables ======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In)    :: NDOF, NDim, NNode ;
Integer (Kind=Smll), Intent(In)    :: NEqEl, NEqElS ;
Integer (Kind=Lng ), Intent(In)    :: IEL ; 


! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------

! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In), Dimension (:  )  :: LoadC ;
Integer (Kind=Lng ), Intent(In), Dimension (:  )  :: ND ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
Real (Kind=DBL), Intent(IN   ), Dimension (:,:)  :: ME, CE, Ke, Fe ;
Real (Kind=DBL), Intent(InOut), Dimension (:,:)  :: FM, FC, FK, P ;

! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------


! =========================== LOCAL Variables =======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Smll)  :: LCASE ;
Integer (Kind=Shrt)  :: I, J, K, L, N ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------

! =========================== Subroutine CODE =======================================================================================================

  DO L = 1, NEqEl ;
    DO N = 1, NEqEl ;

      I  = ND ( L ) ;
      J  = ND ( N ) ;

      IF ( I == 0 .OR. J == 0 ) CYCLE ;

      FK ( I, J ) = FK ( I, J ) + Ke ( L, N ) ;
      FM ( I, J ) = FM ( I, J ) + ME ( L, N ) ;
      FC ( I, J ) = FC ( I, J ) + CE ( L, N ) ;

    End Do ;
  End Do ;

  IF ( ANY( Fe /= 0._DBL )   ) Then ;

    LCASE = MaxVal ( LoadC ) ;! MAX ( LoadC ( 1 ), LoadC ( 2 ) ) ;

      DO I = 1, NEqElS ;
        IF ( ND ( I ) == 0 ) CYCLE ;
        J = ND ( I ) ;
          DO K = 1, LCASE ;
            P ( J, K ) = P ( J, K ) + Fe ( I, K ) ;
          End Do ;
      End Do ;

  End If ;

!#Write(*    ,*) 'End Subroutine < AssembleMassDampingStiffForceFull >' ;
!#Write(UnInf,*) 'End Subroutine < AssembleMassDampingStiffForceFull >' ;
Return ;
End Subroutine AssembleMassDampingStiffForceFull ;

! ***************************************************************************************************************************************************
!                                                                                                                                                  **
! Last Update:  02 Apr 2012                                                                                                                        **
! Description: THIS Subroutine ASSEMBLES force matrix on the boundary in DRM.                                                                      **
!                                                                                                                                                  **
! ***************************************************************************************************************************************************

Subroutine AssembleForceFull (                                                                                                  &
NDOF, NNode,     NEqEl,     IEL,                                                                                                & ! Integer Variables
INOD, ID,                                                                                                                       & ! Integer Arrays
Fe,     P                                                                                                                       & ! Real Arrays
) ;

Implicit None ;

! =========================== Global Variables ======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In)    :: NDOF, NNode ;
Integer (Kind=Smll), Intent(In)    :: NEqEl ;
Integer (Kind=Lng ), Intent(In)    :: IEL ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Lng ), Intent(In), Dimension (:,:)  :: INOD, ID ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
Real (Kind=DBL), Intent(In   ), Dimension (:  )  :: Fe ;
Real (Kind=DBL), Intent(InOut), Dimension (:  )  :: P ;

! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------

! =========================== LOCAL Variables =======================================================================================================
! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Smll)  :: I, J ;                   ! Loop Indices
Integer (Kind=Lng )  :: L, M ;                   ! Loop Indices

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Shrt)  :: ND( NEqEl ) ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------

! =========================== Subroutine CODE =======================================================================================================

ForAll ( I = 1:NNode, J = 1:NDOF ) ND ( ( J - 1 ) * NNode + I ) = ID ( INOD ( I, IEL ) , J ) ;

  DO I = 1, NEqEl ;

    IF ( ND ( I ) == 0 ) CYCLE ;
    L = ND ( I ) ;
    P ( L ) = P ( L ) + Fe ( I ) ;

  End Do ;

!#Write(*     ,*) 'End Subroutine < AssembleForceFull >' ;
!#Write(UnInf,*) 'End Subroutine < AssembleForceFull >' ;
Return ;
End Subroutine AssembleForceFull ;


! ***************************************************************************************************************************************************
!                                                                                                                                                  **
! Start:        09 July 2012                                                                                                                       **
! Last Update:  09 July 2012                                                                                                                       **
! Description: This subroutine assembles the nodal loads in the global force vector.                                                               **
! Called by: Global Matrices.                                                                                                                      **
!                                                                                                                                                  **
! ***************************************************************************************************************************************************

Subroutine AssembleNLoads (                                                                                                     &
NDOF,                                                                                                                           & ! Integer (1) Variables
!                                                                                                                               & ! Integer (2) Variables
NLN,                                                                                                                            & ! Integer (4) Variables
!                                                                                                                               & ! Integer (8) Variables
!                                                                                                                               & ! Real Variables
LoadC, ID, JLoad,                                                                                                               & ! Integer Arrays
PLoad, P                                                                                                                        & ! Real Arrays
!                                                                                                                               & ! Characters
!                                                                                                                               & ! Type
) ;

Implicit None ;

! =========================== Global Variables ======================================================================================================

! - Integer Variables -------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In)    :: NDOF ;
Integer (Kind=Shrt), Intent(In)    :: NLN ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
!#Real (Kind=Dbl),     Intent(In)    ::  ;
!#Real (Kind=Dbl),     Intent(InOut) ::  ;
!#Real (Kind=Dbl),     Intent(OUT)   ::  ;
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
!#Complex,             Intent(In)    ::  ;
!#Complex,             Intent(InOut) ::  ;
!#Complex,             Intent(OUT)   ::  ;
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In),    Dimension (:  )  :: LoadC ;
Integer (Kind=Lng ), Intent(In),    Dimension (:,:)  :: ID ;
Integer (Kind=Lng ), Intent(In),    Dimension (:)    :: JLoad ; 

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
Real (Kind=DBL), Intent(InOut), Dimension (:,:)  :: P ;
Real (Kind=DBL), Intent(In),    Dimension (:,:)  :: PLoad ;
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
!#Character   ::  ;
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
!#Logical   ::  ;
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------
!#Type() :: ;

! =========================== Local Variables =======================================================================================================
! - Integer Variables -------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny)  :: K ;
Integer (Kind=Shrt)  :: I ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
!#Real (Kind=Dbl)      ::  ;
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
!#Complex              ::  ;
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
!#Integer (Kind=Shrt), Dimension (?)  ::  ;
! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
!#Real (Kind=Dbl), Dimension (?)      ::  ;
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
!#Complex  ::  ;
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
!#Character   ::  ;
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
!#Logical   ::  ;
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------

! =========================== Subroutine CODE =======================================================================================================

ForAll ( I = 1:NLN, K = 1:NDOF ) P ( ID ( JLoad ( I ), K ), LoadC ( 3 ) ) = PLoad ( K, I ) ;

Write(*    ,*) 'End Subroutine < AssembleNLoads >' ;
Write(UnInf,*) 'End Subroutine < AssembleNLoads >' ;
Return ;
End Subroutine AssembleNLoads ;


! ***************************************************************************************************************************************************
!                                                                                                                                                  **
! Start:        07 June 2012                                                                                                                       **
! Last Update:  07 JUNE 2012                                                                                                                       **
! Description: THIS Subroutine ASSEMBLES ALL FULL MASS, DAMPING AND THE STIFFNESS MATRICES.                                                        **
!                                                                                                                                                  **
!                                                                                                                                                  **
! ***************************************************************************************************************************************************

Subroutine ASSEMBLE_FULL_MASS_DAMPING_STIFFNESS_DRM  (      &
NDOF, NDim, NNode,                                          &
NEqEl,                                                      &
NNBndry_DRM,                                                &
IEL,                                                        & ! Integer Variables
!                                                           & ! Real Variables
NoBndry_DRM, INOD,                                          & ! Integer Arrays
ME, CE, Ke,     M_bb, C_bb, K_bb                            & ! Real Arrays
) ;

Implicit None ;

! =========================== Global Variables ======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In)    :: NDOF, NDim, NNode ;
Integer (Kind=Smll), Intent(In)    :: NEqEl ;
Integer (Kind=Shrt), Intent(In)    :: NNBndry_DRM ;
Integer (Kind=Lng ), Intent(In)    :: IEL ; 

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Lng ), Intent(In), Dimension (:  )  :: NoBndry_DRM ;
Integer (Kind=Lng ), Intent(In), Dimension (:,:)  :: INOD ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
Real (Kind=DBL), Intent(IN   ), Dimension (:,:)  :: ME, CE, Ke ;
Real (Kind=DBL), Intent(InOut), Dimension (:,:)  :: M_bb, C_bb, K_bb ;
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------

! =========================== LOCAL Variables =======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Lng )  :: INode ;
Integer (Kind=Shrt)  :: I, J, K, L, N ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------

! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Lng )  :: ND( NEqEl ) ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------

! =========================== Subroutine CODE =======================================================================================================

ND (:) = 0_Lng ;

  Do L = 1, NNode
    INode = INod ( L, IEl ) ;

      Do N = 1, NNBndry_DRM ;

        If ( INode == NoBndry_DRM (N) ) Then ;
            Do I = 1,NDim ;
              ND ( ( I - 1 ) * NNode + L ) = ( N - 1 ) * NDim + I ;
            End Do ;
          Exit ;
        End If ;

      End Do ;

  End Do ;

  DO L = 1, NEqEl ;
    DO N = 1, NEqEl ;

      I  = ND ( L ) ;
      J  = ND ( N ) ;
      IF ( I == 0 .OR. J == 0 ) CYCLE ;

      M_bb ( I, J ) = M_bb ( I, J ) + ME ( L, N ) ;
      C_bb ( I, J ) = C_bb ( I, J ) + CE ( L, N ) ;
      K_bb ( I, J ) = K_bb ( I, J ) + Ke ( L, N ) ;

    End Do ;
  End Do ;

!#Write(*     ,*) 'End Subroutine < ASSEMBLE_FULL_MASS_DAMPING_STIFFNESS_DRM >' ;
!#Write(UnInf,*) 'End Subroutine < ASSEMBLE_FULL_MASS_DAMPING_STIFFNESS_DRM >' ;
Return ;
End Subroutine ASSEMBLE_FULL_MASS_DAMPING_STIFFNESS_DRM ;


! ***************************************************************************************************************************************************
!                                                                                                                                                  **
! Start:        11 August 2012                                                                                                                     **
! Last Update:  11 August 2012                                                                                                                     **
! Description: THIS Subroutine ASSEMBLES ALL FULL DAMPING AND THE STIFFNESS MATRICES and mass vector for explicit method.                          **
!                                                                                                                                                  **
!                                                                                                                                                  **
! ***************************************************************************************************************************************************

Subroutine AssembleMassDampingStiffForceFullSpec  (    &
NEqEl, NEqElS, NDOF, NDim, NNode, IEL,                      & ! Integer Variables
!                                                           & ! Real Variables
LoadC, ND,                                                  & ! Integer Arrays
ME, CE, Ke, Fe,    VM, FC, FK, P                            & ! Real Arrays
) ;

Implicit None ;

! =========================== Global Variables ======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In)    :: NDOF, NDim, NNode ;
Integer (Kind=Smll), Intent(In)    :: NEqEl, NEqElS ;
Integer (Kind=Lng ), Intent(In)    :: IEL ; 


! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------

! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Tiny), Intent(In), Dimension (:  )  :: LoadC ;
Integer (Kind=Lng ), Intent(In), Dimension (:  )  :: ND ;

! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
Real (Kind=DBL), Intent(IN   ), Dimension (:,:)  :: ME, CE, Ke, Fe ;
Real (Kind=DBL), Intent(InOut), Dimension (:,:)  :: FC, FK, P ;
Real (Kind=DBL), Intent(InOut), Dimension (:  )  :: VM ;

! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------


! =========================== LOCAL Variables =======================================================================================================

! - Integer Arrays ------------------------------------------------------------------------------------------------------------------------------
Integer (Kind=Smll)  :: LCASE ;
Integer (Kind=Shrt)  :: I, J, K, L, N ;

! - Real Variables ----------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Integer Arrays ----------------------------------------------------------------------------------------------------------------------------------
! - Real Arrays -------------------------------------------------------------------------------------------------------------------------------------
! - Complex Variables -------------------------------------------------------------------------------------------------------------------------------
! - Character Variables -----------------------------------------------------------------------------------------------------------------------------
! - Logical Variables -------------------------------------------------------------------------------------------------------------------------------
! - Type DECLERATIONS -------------------------------------------------------------------------------------------------------------------------------

! =========================== Subroutine CODE =======================================================================================================

  DO L = 1, NEqEl ;

    I  = ND ( L ) ;

    IF ( I == 0 ) CYCLE ;

      DO N = 1, NEqEl ;

        J  = ND ( N ) ;

        IF ( J == 0 ) CYCLE ;

        FK ( I, J ) = FK ( I, J ) + Ke ( L, N ) ;
        FC ( I, J ) = FC ( I, J ) + CE ( L, N ) ;

      End Do ;

    VM ( I ) = VM ( I ) + ME ( L, L ) ;

  End Do ;

  IF ( ANY( Fe /= 0._DBL )   ) Then ;

    LCASE = MaxVal ( LoadC ) ;! MAX ( LoadC ( 1 ), LoadC ( 2 ) ) ;

      DO I = 1, NEqElS ;
        IF ( ND ( I ) == 0 ) CYCLE ;
        J = ND ( I ) ;
          DO K = 1, LCASE ;
            P ( J, K ) = P ( J, K ) + Fe ( I, K ) ;
          End Do ;
      End Do ;

  End If ;

!#Write(*    ,*) 'End Subroutine < AssembleMassDampingStiffForceFullSpec >' ;
!#Write(UnInf,*) 'End Subroutine < AssembleMassDampingStiffForceFullSpec >' ;
Return ;
End Subroutine AssembleMassDampingStiffForceFullSpec ;

End Module AssembleSub ;
