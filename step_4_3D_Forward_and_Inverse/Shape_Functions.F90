!************************************************
! Shape functions 3D-serendipity-20 node
!************************************************
! REVISION : F, 20 April 2012

SUBROUTINE SHAPE_3_20 ( X1, X2, X3, FN, DFXI )
IMPLICIT DOUBLE PRECISION (A-H,O-Z)

DIMENSION FN(20), DFXI(20,3)

FN(1) = 0.125d0 * (1.0d0+X1) * (1.0d0-X2) * (1.0d0-X3) * (-2.0d0+X1-X2-X3)
FN(2) = 0.125d0 * (1.0d0+X1) * (1.0d0+X2) * (1.0d0-X3) * (-2.0d0+X1+X2-X3)
FN(3) = 0.125d0 * (1.0d0-X1) * (1.0d0+X2) * (1.0d0-X3) * (-2.0d0-X1+X2-X3)
FN(4) = 0.125d0 * (1.0d0-X1) * (1.0d0-X2) * (1.0d0-X3) * (-2.0d0-X1-X2-X3)
FN(5) = 0.125d0 * (1.0d0+X1) * (1.0d0-X2) * (1.0d0+X3) * (-2.0d0+X1-X2+X3)
FN(6) = 0.125d0 * (1.0d0+X1) * (1.0d0+X2) * (1.0d0+X3) * (-2.0d0+X1+X2+X3)
FN(7) = 0.125d0 * (1.0d0-X1) * (1.0d0+X2) * (1.0d0+X3) * (-2.0d0-X1+X2+X3)
FN(8) = 0.125d0 * (1.0d0-X1) * (1.0d0-X2) * (1.0d0+X3) * (-2.0d0-X1-X2+X3)
        
FN(9 ) = 0.25d0 * (1.0d0-X2**2) * (1.0d0+X1) * (1.0d0-X3)
FN(10) = 0.25d0 * (1.0d0-X1**2) * (1.0d0+X2) * (1.0d0-X3)
FN(11) = 0.25d0 * (1.0d0-X2**2) * (1.0d0-X1) * (1.0d0-X3)
FN(12) = 0.25d0 * (1.0d0-X1**2) * (1.0d0-X2) * (1.0d0-X3)
FN(13) = 0.25d0 * (1.0d0-X3**2) * (1.0d0+X1) * (1.0d0-X2)
FN(14) = 0.25d0 * (1.0d0-X3**2) * (1.0d0+X1) * (1.0d0+X2)
FN(15) = 0.25d0 * (1.0d0-X3**2) * (1.0d0-X1) * (1.0d0+X2)
FN(16) = 0.25d0 * (1.0d0-X3**2) * (1.0d0-X1) * (1.0d0-X2)
FN(17) = 0.25d0 * (1.0d0-X2**2) * (1.0d0+X1) * (1.0d0+X3)
FN(18) = 0.25d0 * (1.0d0-X1**2) * (1.0d0+X2) * (1.0d0+X3)
FN(19) = 0.25d0 * (1.0d0-X2**2) * (1.0d0-X1) * (1.0d0+X3)
FN(20) = 0.25d0 * (1.0d0-X1**2) * (1.0d0-X2) * (1.0d0+X3)
        

DFXI(1,1) = 0.125d0 * (1.0d0-X2) * (1.0d0-X3) * (-1.0d0+2.0d0*X1-X2-X3)
DFXI(1,2) = 0.125d0 * (1.0d0+X1) * (1.0d0-X3) * ( 1.0d0-X1+2.0d0*X2+X3)
DFXI(1,3) = 0.125d0 * (1.0d0+X1) * (1.0d0-X2) * ( 1.0d0-X1+X2+2.0d0*X3)
         
DFXI(2,1) = 0.125d0 * (1.0d0+X2) * (1.0d0-X3) * (-1.0d0+2.0d0*X1+X2-X3)
DFXI(2,2) = 0.125d0 * (1.0d0+X1) * (1.0d0-X3) * (-1.0d0+X1+2.0d0*X2-X3)
DFXI(2,3) = 0.125d0 * (1.0d0+X1) * (1.0d0+X2) * ( 1.0d0-X1-X2+2.0d0*X3)
        
DFXI(3,1) = 0.125d0 * (1.0d0+X2) * (1.0d0-X3) * ( 1.0d0+2.0d0*X1-X2+X3)
DFXI(3,2) = 0.125d0 * (1.0d0-X1) * (1.0d0-X3) * (-1.0d0-X1+2.0d0*X2-X3)
DFXI(3,3) = 0.125d0 * (1.0d0-X1) * (1.0d0+X2) * ( 1.0d0+X1-X2+2.0d0*X3)
        
DFXI(4,1) = 0.125d0 * (1.0d0-X2) * (1.0d0-X3) * ( 1.0d0+2.0d0*X1+X2+X3)
DFXI(4,2) = 0.125d0 * (1.0d0-X1) * (1.0d0-X3) * ( 1.0d0+X1+2.0d0*X2+X3)
DFXI(4,3) = 0.125d0 * (1.0d0-X1) * (1.0d0-X2) * ( 1.0d0+X1+X2+2.0d0*X3)
        
DFXI(5,1) = 0.125d0 * (1.0d0-X2) * (1.0d0+X3) * (-1.0d0+2.0d0*X1-X2+X3)
DFXI(5,2) = 0.125d0 * (1.0d0+X1) * (1.0d0+X3) * ( 1.0d0-X1+2.0d0*X2-X3)
DFXI(5,3) = 0.125d0 * (1.0d0+X1) * (1.0d0-X2) * (-1.0d0+X1-X2+2.0d0*X3)

DFXI(6,1) = 0.125d0 * (1.0d0+X2) * (1.0d0+X3) * (-1.0d0+2.0d0*X1+X2+X3)
DFXI(6,2) = 0.125d0 * (1.0d0+X1) * (1.0d0+X3) * (-1.0d0+X1+2.0d0*X2+X3)
DFXI(6,3) = 0.125d0 * (1.0d0+X1) * (1.0d0+X2) * (-1.0d0+X1+X2+2.0d0*X3)
        
DFXI(7,1) = 0.125d0 * (1.0d0+X2) * (1.0d0+X3) * ( 1.0d0+2.0d0*X1-X2-X3)
DFXI(7,2) = 0.125d0 * (1.0d0-X1) * (1.0d0+X3) * (-1.0d0-X1+2.0d0*X2+X3)
DFXI(7,3) = 0.125d0 * (1.0d0-X1) * (1.0d0+X2) * (-1.0d0-X1+X2+2.0d0*X3)
        
DFXI(8,1) = 0.125d0 * (1.0d0-X2) * (1.0d0+X3) * ( 1.0d0+2.0d0*X1+X2-X3)
DFXI(8,2) = 0.125d0 * (1.0d0-X1) * (1.0d0+X3) * ( 1.0d0+X1+2.0d0*X2-X3)
DFXI(8,3) = 0.125d0 * (1.0d0-X1) * (1.0d0-X2) * (-1.0d0-X1-X2+2.0d0*X3)
        
DFXI(9,1) = 0.25d0 * (1.0d0-X2**2) * (1.0d0-X3)
DFXI(9,2) =-0.50d0 * X2*(1.0d0+X1) * (1.0d0-X3)
DFXI(9,3) =-0.25d0 * (1.0d0-X2**2) * (1.0d0+X1)
        
DFXI(10,1) =-0.50d0 * X1*(1.0d0+X2) * (1.0d0-X3)
DFXI(10,2) = 0.25d0 * (1.0d0-X1**2) * (1.0d0-X3)
DFXI(10,3) =-0.25d0 * (1.0d0-X1**2) * (1.0d0+X2)
        
DFXI(11,1) =-0.25d0 * (1.0d0-X2**2) * (1.0d0-X3)
DFXI(11,2) =-0.50d0 * X2*(1.0d0-X1) * (1.0d0-X3)
DFXI(11,3) =-0.25d0 * (1.0d0-X2**2) * (1.0d0-X1)
        
DFXI(12,1) =-0.50d0 * X1*(1.0d0-X2) * (1.0d0-X3)
DFXI(12,2) =-0.25d0 * (1.0d0-X1**2) * (1.0d0-X3)
DFXI(12,3) =-0.25d0 * (1.0d0-X1**2) * (1.0d0-X2)
        
DFXI(13,1) = 0.25d0 * (1.0d0-X3**2) * (1.0d0-X2)
DFXI(13,2) =-0.25d0 * (1.0d0-X3**2) * (1.0d0+X1)
DFXI(13,3) =-0.50d0 * X3*(1.0d0+X1) * (1.0d0-X2)
        
DFXI(14,1) = 0.25d0 * (1.0d0-X3**2) * (1.0d0+X2)
DFXI(14,2) = 0.25d0 * (1.0d0-X3**2) * (1.0d0+X1)
DFXI(14,3) =-0.50d0 * X3*(1.0d0+X1) * (1.0d0+X2)
        
DFXI(15,1) =-0.25d0 * (1.0d0-X3**2) * (1.0d0+X2)
DFXI(15,2) = 0.25d0 * (1.0d0-X3**2) * (1.0d0-X1)
DFXI(15,3) =-0.50d0 * X3*(1.0d0-X1) * (1.0d0+X2)
        
DFXI(16,1) =-0.25d0 * (1.0d0-X3**2) * (1.0d0-X2)
DFXI(16,2) =-0.25d0 * (1.0d0-X3**2) * (1.0d0-X1)
DFXI(16,3) =-0.50d0 * X3*(1.0d0-X1) * (1.0d0-X2)
        
DFXI(17,1) = 0.25d0 * (1.0d0-X2**2) * (1.0d0+X3)
DFXI(17,2) =-0.50d0 * X2*(1.0d0+X1) * (1.0d0+X3)
DFXI(17,3) = 0.25d0 * (1.0d0-X2**2) * (1.0d0+X1)
        
DFXI(18,1) =-0.50d0 * X1*(1.0d0+X2) * (1.0d0+X3)
DFXI(18,2) = 0.25d0 * (1.0d0-X1**2) * (1.0d0+X3)
DFXI(18,3) = 0.25d0 * (1.0d0-X1**2) * (1.0d0+X2)

DFXI(19,1) =-0.25d0 * (1.0d0-X2**2) * (1.0d0+X3)
DFXI(19,2) =-0.50d0 * X2*(1.0d0-X1) * (1.0d0+X3)
DFXI(19,3) = 0.25d0 * (1.0d0-X2**2) * (1.0d0-X1)
        
DFXI(20,1) =-0.50d0 * X1*(1.0d0-X2) * (1.0d0+X3)
DFXI(20,2) =-0.25d0 * (1.0d0-X1**2) * (1.0d0+X3)
DFXI(20,3) = 0.25d0 * (1.0d0-X1**2) * (1.0d0-X2)


RETURN
END


!************************************************
! Shape functions 3D-Lagrange-27 node
!************************************************
! REVISION : Tu, 22 May 2012

SUBROUTINE SHAPE_3_27 ( X1, X2, X3, FN, DFXI )
IMPLICIT DOUBLE PRECISION (A-H,O-Z)

DIMENSION FN(27), DFXI(27,3)

FN(1) = 0.125d0 *  X1 * -X2 * -X3 * (1.0d0+X1) * (1.0d0-X2) * (1.0d0-X3)
FN(2) = 0.125d0 *  X1 *  X2 * -X3 * (1.0d0+X1) * (1.0d0+X2) * (1.0d0-X3)
FN(3) = 0.125d0 * -X1 *  X2 * -X3 * (1.0d0-X1) * (1.0d0+X2) * (1.0d0-X3)
FN(4) = 0.125d0 * -X1 * -X2 * -X3 * (1.0d0-X1) * (1.0d0-X2) * (1.0d0-X3)
FN(5) = 0.125d0 *  X1 * -X2 *  X3 * (1.0d0+X1) * (1.0d0-X2) * (1.0d0+X3)
FN(6) = 0.125d0 *  X1 *  X2 *  X3 * (1.0d0+X1) * (1.0d0+X2) * (1.0d0+X3)
FN(7) = 0.125d0 * -X1 *  X2 *  X3 * (1.0d0-X1) * (1.0d0+X2) * (1.0d0+X3)
FN(8) = 0.125d0 * -X1 * -X2 *  X3 * (1.0d0-X1) * (1.0d0-X2) * (1.0d0+X3)

FN(9 ) = 0.25d0 *  X1 * -X3 * (1.0d0+X1) * (1.0d0-X3) * (1.0d0-X2**2)
FN(11) = 0.25d0 * -X1 * -X3 * (1.0d0-X1) * (1.0d0-X3) * (1.0d0-X2**2)
FN(17) = 0.25d0 *  X1 *  X3 * (1.0d0+X1) * (1.0d0+X3) * (1.0d0-X2**2)
FN(19) = 0.25d0 * -X1 *  X3 * (1.0d0-X1) * (1.0d0+X3) * (1.0d0-X2**2)

FN(10) = 0.25d0 *  X2 * -X3 * (1.0d0+X2) * (1.0d0-X3) * (1.0d0-X1**2)
FN(12) = 0.25d0 * -X2 * -X3 * (1.0d0-X2) * (1.0d0-X3) * (1.0d0-X1**2)
FN(18) = 0.25d0 *  X2 *  X3 * (1.0d0+X2) * (1.0d0+X3) * (1.0d0-X1**2)
FN(20) = 0.25d0 * -X2 *  X3 * (1.0d0-X2) * (1.0d0+X3) * (1.0d0-X1**2)

FN(13) = 0.25d0 * -X2 *  X1 * (1.0d0-X2) * (1.0d0+X1) * (1.0d0-X3**2)
FN(14) = 0.25d0 *  X2 *  X1 * (1.0d0+X2) * (1.0d0+X1) * (1.0d0-X3**2)
FN(15) = 0.25d0 *  X2 * -X1 * (1.0d0+X2) * (1.0d0-X1) * (1.0d0-X3**2)
FN(16) = 0.25d0 * -X2 * -X1 * (1.0d0-X2) * (1.0d0-X1) * (1.0d0-X3**2)

FN(21) = 0.50d0 * -X3 * (1.0d0-X3) * (1.0d0-X1**2) * (1.0d0-X2**2)
FN(26) = 0.50d0 *  X3 * (1.0d0+X3) * (1.0d0-X1**2) * (1.0d0-X2**2)

FN(22) = 0.50d0 *  X1 * (1.0d0+X1) * (1.0d0-X2**2) * (1.0d0-X3**2)
FN(24) = 0.50d0 * -X1 * (1.0d0-X1) * (1.0d0-X2**2) * (1.0d0-X3**2)

FN(23) = 0.50d0 *  X2 * (1.0d0+X2) * (1.0d0-X1**2) * (1.0d0-X3**2)
FN(25) = 0.50d0 * -X2 * (1.0d0-X2) * (1.0d0-X1**2) * (1.0d0-X3**2)

FN(27) = (1.0d0-X1**2) * (1.0d0-X2**2) * (1.0d0-X3**2)


DFXI(1,1) = 0.125d0 * -X2 * -X3 * (1.0d0-X2) * (1.0d0-X3) * ( 1.0d0 + 2.0d0 * X1 ) 
DFXI(2,1) = 0.125d0 *  X2 * -X3 * (1.0d0+X2) * (1.0d0-X3) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(3,1) = 0.125d0 *  X2 * -X3 * (1.0d0+X2) * (1.0d0-X3) * (-1.0d0 + 2.0d0 * X1 )
DFXI(4,1) = 0.125d0 * -X2 * -X3 * (1.0d0-X2) * (1.0d0-X3) * (-1.0d0 + 2.0d0 * X1 )
DFXI(5,1) = 0.125d0 * -X2 *  X3 * (1.0d0-X2) * (1.0d0+X3) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(6,1) = 0.125d0 *  X2 *  X3 * (1.0d0+X2) * (1.0d0+X3) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(7,1) = 0.125d0 *  X2 *  X3 * (1.0d0+X2) * (1.0d0+X3) * (-1.0d0 + 2.0d0 * X1 )
DFXI(8,1) = 0.125d0 * -X2 *  X3 * (1.0d0-X2) * (1.0d0+X3) * (-1.0d0 + 2.0d0 * X1 )

DFXI(9 ,1) = 0.25d0 * -X3 * (1.0d0-X3) * (1.0d0-X2**2) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(11,1) = 0.25d0 * -X3 * (1.0d0-X3) * (1.0d0-X2**2) * (-1.0d0 + 2.0d0 * X1 )
DFXI(17,1) = 0.25d0 *  X3 * (1.0d0+X3) * (1.0d0-X2**2) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(19,1) = 0.25d0 *  X3 * (1.0d0+X3) * (1.0d0-X2**2) * (-1.0d0 + 2.0d0 * X1 )

DFXI(10,1) = 0.50d0 *  X2 * -X3 * (1.0d0+X2) * (1.0d0-X3) * (-X1)
DFXI(12,1) = 0.50d0 * -X2 * -X3 * (1.0d0-X2) * (1.0d0-X3) * (-X1)
DFXI(18,1) = 0.50d0 *  X2 *  X3 * (1.0d0+X2) * (1.0d0+X3) * (-X1)
DFXI(20,1) = 0.50d0 * -X2 *  X3 * (1.0d0-X2) * (1.0d0+X3) * (-X1)

DFXI(13,1) = 0.25d0 * -X2 * (1.0d0-X2) * (1.0d0-X3**2) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(14,1) = 0.25d0 *  X2 * (1.0d0+X2) * (1.0d0-X3**2) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(15,1) = 0.25d0 *  X2 * (1.0d0+X2) * (1.0d0-X3**2) * (-1.0d0 + 2.0d0 * X1 )
DFXI(16,1) = 0.25d0 * -X2 * (1.0d0-X2) * (1.0d0-X3**2) * (-1.0d0 + 2.0d0 * X1 )

DFXI(21,1) = -X3 * (1.0d0-X3) * (-X1) * (1.0d0-X2**2)
DFXI(26,1) =  X3 * (1.0d0+X3) * (-X1) * (1.0d0-X2**2)

DFXI(22,1) = 0.50d0 * (1.0d0-X2**2) * (1.0d0-X3**2) * ( 1.0d0 + 2.0d0 * X1 )
DFXI(24,1) = 0.50d0 * (1.0d0-X2**2) * (1.0d0-X3**2) * (-1.0d0 + 2.0d0 * X1 )

DFXI(23,1) =  X2 * (1.0d0+X2) * (-X1) * (1.0d0-X3**2)
DFXI(25,1) = -X2 * (1.0d0-X2) * (-X1) * (1.0d0-X3**2)

DFXI(27,1) = (-2.0D0*X1) * (1.0d0-X2**2) * (1.0d0-X3**2)


DFXI(1,2) = 0.125d0 *  X1 * -X3 * (1.0d0+X1) * (-1.0d0+2.0D0*X2) * (1.0d0-X3)
DFXI(2,2) = 0.125d0 *  X1 * -X3 * (1.0d0+X1) * (+1.0d0+2.0D0*X2) * (1.0d0-X3)
DFXI(3,2) = 0.125d0 * -X1 * -X3 * (1.0d0-X1) * (+1.0d0+2.0D0*X2) * (1.0d0-X3)
DFXI(4,2) = 0.125d0 * -X1 * -X3 * (1.0d0-X1) * (-1.0d0+2.0D0*X2) * (1.0d0-X3)
DFXI(5,2) = 0.125d0 *  X1 *  X3 * (1.0d0+X1) * (-1.0d0+2.0D0*X2) * (1.0d0+X3)
DFXI(6,2) = 0.125d0 *  X1 *  X3 * (1.0d0+X1) * (+1.0d0+2.0D0*X2) * (1.0d0+X3)
DFXI(7,2) = 0.125d0 * -X1 *  X3 * (1.0d0-X1) * (+1.0d0+2.0D0*X2) * (1.0d0+X3)
DFXI(8,2) = 0.125d0 * -X1 *  X3 * (1.0d0-X1) * (-1.0d0+2.0D0*X2) * (1.0d0+X3)

DFXI(9 ,2) = 0.50d0 *  X1 * -X3 * (1.0d0+X1) * (1.0d0-X3) * (-X2)
DFXI(11,2) = 0.50d0 * -X1 * -X3 * (1.0d0-X1) * (1.0d0-X3) * (-X2)
DFXI(17,2) = 0.50d0 *  X1 *  X3 * (1.0d0+X1) * (1.0d0+X3) * (-X2)
DFXI(19,2) = 0.50d0 * -X1 *  X3 * (1.0d0-X1) * (1.0d0+X3) * (-X2)

DFXI(10,2) = 0.25d0 * -X3 * (+1.0d0+2.0d0*X2) * (1.0d0-X3) * (1.0d0-X1**2)
DFXI(12,2) = 0.25d0 * -X3 * (-1.0d0+2.0d0*X2) * (1.0d0-X3) * (1.0d0-X1**2)
DFXI(18,2) = 0.25d0 *  X3 * (+1.0d0+2.0d0*X2) * (1.0d0+X3) * (1.0d0-X1**2)
DFXI(20,2) = 0.25d0 *  X3 * (-1.0d0+2.0d0*X2) * (1.0d0+X3) * (1.0d0-X1**2)

DFXI(13,2) = 0.25d0 *  X1 * (-1.0d0+2.0d0*X2) * (1.0d0+X1) * (1.0d0-X3**2)
DFXI(14,2) = 0.25d0 *  X1 * (+1.0d0+2.0d0*X2) * (1.0d0+X1) * (1.0d0-X3**2)
DFXI(15,2) = 0.25d0 * -X1 * (+1.0d0+2.0d0*X2) * (1.0d0-X1) * (1.0d0-X3**2)
DFXI(16,2) = 0.25d0 * -X1 * (-1.0d0+2.0d0*X2) * (1.0d0-X1) * (1.0d0-X3**2)

DFXI(21,2) = -X3 * (1.0d0-X3) * (1.0d0-X1**2) * (-X2)
DFXI(26,2) =  X3 * (1.0d0+X3) * (1.0d0-X1**2) * (-X2)

DFXI(22,2) =  X1 * (1.0d0+X1) * (-X2) * (1.0d0-X3**2)
DFXI(24,2) = -X1 * (1.0d0-X1) * (-X2) * (1.0d0-X3**2)

DFXI(23,2) = 0.50d0 * (+1.0d0+2.0d0*X2) * (1.0d0-X1**2) * (1.0d0-X3**2)
DFXI(25,2) = 0.50d0 * (-1.0d0+2.0d0*X2) * (1.0d0-X1**2) * (1.0d0-X3**2)

DFXI(27,2) = (1.0d0-X1**2) * (-2.0d0*X2) * (1.0d0-X3**2)


DFXI(1,3) = 0.125d0 *  X1 * -X2 * (1.0d0+X1) * (1.0d0-X2) * (-1.0d0+2.0D0*X3)
DFXI(2,3) = 0.125d0 *  X1 *  X2 * (1.0d0+X1) * (1.0d0+X2) * (-1.0d0+2.0D0*X3)
DFXI(3,3) = 0.125d0 * -X1 *  X2 * (1.0d0-X1) * (1.0d0+X2) * (-1.0d0+2.0D0*X3)
DFXI(4,3) = 0.125d0 * -X1 * -X2 * (1.0d0-X1) * (1.0d0-X2) * (-1.0d0+2.0D0*X3)
DFXI(5,3) = 0.125d0 *  X1 * -X2 * (1.0d0+X1) * (1.0d0-X2) * (+1.0d0+2.0D0*X3)
DFXI(6,3) = 0.125d0 *  X1 *  X2 * (1.0d0+X1) * (1.0d0+X2) * (+1.0d0+2.0D0*X3)
DFXI(7,3) = 0.125d0 * -X1 *  X2 * (1.0d0-X1) * (1.0d0+X2) * (+1.0d0+2.0D0*X3)
DFXI(8,3) = 0.125d0 * -X1 * -X2 * (1.0d0-X1) * (1.0d0-X2) * (+1.0d0+2.0D0*X3)

DFXI(9 ,3) = 0.25d0 *  X1 * (1.0d0+X1) * (-1.0d0+2.0D0*X3) * (1.0d0-X2**2)
DFXI(11,3) = 0.25d0 * -X1 * (1.0d0-X1) * (-1.0d0+2.0D0*X3) * (1.0d0-X2**2)
DFXI(17,3) = 0.25d0 *  X1 * (1.0d0+X1) * (+1.0d0+2.0D0*X3) * (1.0d0-X2**2)
DFXI(19,3) = 0.25d0 * -X1 * (1.0d0-X1) * (+1.0d0+2.0D0*X3) * (1.0d0-X2**2)

DFXI(10,3) = 0.25d0 *  X2 * (1.0d0+X2) * (-1.0d0+2.0D0*X3) * (1.0d0-X1**2)
DFXI(12,3) = 0.25d0 * -X2 * (1.0d0-X2) * (-1.0d0+2.0D0*X3) * (1.0d0-X1**2)
DFXI(18,3) = 0.25d0 *  X2 * (1.0d0+X2) * (+1.0d0+2.0D0*X3) * (1.0d0-X1**2)
DFXI(20,3) = 0.25d0 * -X2 * (1.0d0-X2) * (+1.0d0+2.0D0*X3) * (1.0d0-X1**2)

DFXI(13,3) = 0.50d0 * -X2 *  X1 * (1.0d0-X2) * (1.0d0+X1) * (-X3)
DFXI(14,3) = 0.50d0 *  X2 *  X1 * (1.0d0+X2) * (1.0d0+X1) * (-X3)
DFXI(15,3) = 0.50d0 *  X2 * -X1 * (1.0d0+X2) * (1.0d0-X1) * (-X3)
DFXI(16,3) = 0.50d0 * -X2 * -X1 * (1.0d0-X2) * (1.0d0-X1) * (-X3)

DFXI(21,3) = 0.50d0 * (-1.0d0+2.0d0*X3) * (1.0d0-X1**2) * (1.0d0-X2**2)
DFXI(26,3) = 0.50d0 * (+1.0d0+2.0d0*X3) * (1.0d0-X1**2) * (1.0d0-X2**2)

DFXI(22,3) =  X1 * (1.0d0+X1) * (1.0d0-X2**2) * (-X3)
DFXI(24,3) = -X1 * (1.0d0-X1) * (1.0d0-X2**2) * (-X3)

DFXI(23,3) =  X2 * (1.0d0+X2) * (1.0d0-X1**2) * (-X3)
DFXI(25,3) = -X2 * (1.0d0-X2) * (1.0d0-X1**2) * (-X3)

DFXI(27,3) = (1.0d0-X1**2) * (1.0d0-X2**2) * (-2.0d0*X3)


RETURN
END


!************************************************
! Shape functions 3D-Lagrange-8 node
!************************************************
! REVISION : Tu, 31 March 2015
! I'm still in ECJ 4.602. I want to get the ... out!

SUBROUTINE SHAPE_3_8 ( X1, X2, X3, FN )
IMPLICIT DOUBLE PRECISION (A-H,O-Z)

DIMENSION FN(8)

FN(1) = 0.125d0 *  X1 * -X2 * -X3 * (1.0d0+X1) * (1.0d0-X2) * (1.0d0-X3)
FN(2) = 0.125d0 *  X1 *  X2 * -X3 * (1.0d0+X1) * (1.0d0+X2) * (1.0d0-X3)
FN(3) = 0.125d0 * -X1 *  X2 * -X3 * (1.0d0-X1) * (1.0d0+X2) * (1.0d0-X3)
FN(4) = 0.125d0 * -X1 * -X2 * -X3 * (1.0d0-X1) * (1.0d0-X2) * (1.0d0-X3)
FN(5) = 0.125d0 *  X1 * -X2 *  X3 * (1.0d0+X1) * (1.0d0-X2) * (1.0d0+X3)
FN(6) = 0.125d0 *  X1 *  X2 *  X3 * (1.0d0+X1) * (1.0d0+X2) * (1.0d0+X3)
FN(7) = 0.125d0 * -X1 *  X2 *  X3 * (1.0d0-X1) * (1.0d0+X2) * (1.0d0+X3)
FN(8) = 0.125d0 * -X1 * -X2 *  X3 * (1.0d0-X1) * (1.0d0-X2) * (1.0d0+X3)

RETURN
END








